{% extends "base.html" %}

{% block title %}Proveedores - Veterinaria{% endblock %}

{% block content %}
<div x-data="proveedoresApp()" x-cloak>
    <!-- Encabezado con acciones principales -->
    <div class="bg-gradient-to-r from-purple-600 to-purple-800 text-white rounded-lg shadow-lg mb-6 p-6">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
            <div>
                <h2 class="text-3xl font-bold mb-2">
                    <i class="fas fa-truck mr-3"></i>Proveedores
                </h2>
                <p class="text-purple-100">Gestiona tus proveedores</p>
            </div>
            <a href="{{ url_for('proveedores.crear') }}" 
               class="bg-white text-purple-600 px-6 py-3 rounded-lg font-bold text-lg hover:bg-purple-50 transition-all shadow-lg hover:shadow-xl transform hover:scale-105 flex items-center">
                <i class="fas fa-plus-circle mr-2 text-2xl"></i>
                <span>NUEVO PROVEEDOR</span>
            </a>
        </div>
    </div>

    <!-- Barra de búsqueda -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
        <div class="flex flex-col md:flex-row gap-4">
            <div class="flex-1">
                <label class="block text-lg font-semibold text-gray-700 mb-3">
                    <i class="fas fa-search mr-2 text-purple-600"></i>Buscar Proveedor
                </label>
                <input type="text" 
                       x-model="busqueda"
                       @input="filtrarProveedores()"
                       placeholder="Escribe el nombre del proveedor..."
                       class="w-full px-5 py-4 text-lg border-2 border-gray-300 rounded-lg focus:ring-4 focus:ring-purple-500 focus:border-purple-500 transition-all">
            </div>
            <div class="flex items-end">
                <button @click="limpiarBusqueda()" 
                        class="px-6 py-4 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors font-semibold text-lg">
                    <i class="fas fa-redo mr-2"></i>Limpiar
                </button>
            </div>
        </div>
    </div>

    <!-- Mensaje cuando no hay proveedores -->
    <template x-if="proveedoresFiltrados.length === 0">
        <div class="bg-white rounded-lg shadow-md p-12 text-center">
            <i class="fas fa-truck text-6xl text-gray-300 mb-4"></i>
            <h3 class="text-2xl font-bold text-gray-700 mb-2">No hay proveedores</h3>
            <p class="text-gray-500 mb-6">Comienza agregando tu primer proveedor</p>
            <a href="{{ url_for('proveedores.crear') }}" 
               class="inline-block bg-purple-600 text-white px-8 py-4 rounded-lg font-bold text-lg hover:bg-purple-700 transition-all shadow-lg">
                <i class="fas fa-plus-circle mr-2"></i>Crear Primer Proveedor
            </a>
        </div>
    </template>

    <!-- Grid de proveedores -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" x-show="proveedoresFiltrados.length > 0">
        <template x-for="proveedor in proveedoresFiltrados" :key="proveedor.id">
            <div class="bg-white rounded-xl shadow-lg hover:shadow-2xl transition-all transform hover:scale-105 border-2 border-gray-100">
                <div class="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-4 rounded-t-xl">
                    <h3 class="text-xl font-bold" x-text="proveedor.nombre"></h3>
                </div>
                <div class="p-5">
                    <div class="space-y-3 mb-4">
                        <template x-if="proveedor.telefono">
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-phone mr-2 text-purple-600"></i>
                                <span x-text="proveedor.telefono"></span>
                            </div>
                        </template>
                        <template x-if="proveedor.correo_electronico">
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-envelope mr-2 text-purple-600"></i>
                                <span x-text="proveedor.correo_electronico"></span>
                            </div>
                        </template>
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="fas fa-shopping-cart mr-2 text-purple-600"></i>
                            <span x-text="proveedor.total_compras + ' compra(s)'"></span>
                        </div>
                    </div>
                    <div class="mb-4">
                        <span class="px-3 py-1 rounded-full text-sm font-semibold"
                              :class="proveedor.activo ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'"
                              x-text="proveedor.activo ? '✓ Activo' : '✗ Inactivo'">
                        </span>
                    </div>
                    <div class="flex gap-2 mt-5">
                        <a :href="'/proveedores/' + proveedor.id + '/productos'" 
                           class="flex-1 bg-blue-600 text-white px-4 py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors text-center">
                            <i class="fas fa-boxes mr-2"></i>Productos
                        </a>
                        <a :href="'/proveedores/editar/' + proveedor.id" 
                           class="bg-purple-600 text-white px-4 py-3 rounded-lg font-semibold hover:bg-purple-700 transition-colors">
                            <i class="fas fa-edit"></i>
                        </a>
                        <button @click="confirmarEliminar(proveedor.id, proveedor.nombre)"
                                class="bg-red-600 text-white px-4 py-3 rounded-lg font-semibold hover:bg-red-700 transition-colors">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </template>
    </div>
</div>

<script>
function proveedoresApp() {
    return {
        proveedores: [
            {% for proveedor in proveedores %}
            {
                id: {{ proveedor.id }},
                nombre: {{ proveedor.nombre | tojson | safe }},
                telefono: {{ (proveedor.telefono or '') | tojson | safe }},
                correo_electronico: {{ (proveedor.correo_electronico or '') | tojson | safe }},
                activo: {{ 'true' if proveedor.activo else 'false' }},
                total_compras: {{ proveedor.total_compras }}
            }{% if not loop.last %},{% endif %}
            {% endfor %}
        ],
        busqueda: '',
        proveedoresFiltrados: [],

        init() {
            console.log('Proveedores cargados:', this.proveedores.length);
            this.proveedoresFiltrados = this.proveedores;
        },

        filtrarProveedores() {
            const termino = this.busqueda.toLowerCase().trim();
            if (!termino) {
                this.proveedoresFiltrados = this.proveedores;
                return;
            }

            this.proveedoresFiltrados = this.proveedores.filter(p => {
                const nombre = (p.nombre || '').toLowerCase();
                const telefono = (p.telefono || '').toLowerCase();
                const correo = (p.correo_electronico || '').toLowerCase();
                
                return nombre.includes(termino) || 
                       telefono.includes(termino) || 
                       correo.includes(termino);
            });
        },

        limpiarBusqueda() {
            this.busqueda = '';
            this.proveedoresFiltrados = this.proveedores;
        },

        confirmarEliminar(id, nombre) {
            if (confirm(`¿Estás seguro de desactivar el proveedor "${nombre}"?`)) {
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = `/proveedores/eliminar/${id}`;
                document.body.appendChild(form);
                form.submit();
            }
        }
    }
}
</script>
{% endblock %}

